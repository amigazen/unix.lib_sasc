#
# SAS/C smakefile for unix.lib
# Converted from a Lattice C lmkfile (Corrected for GST usage)
#

## Macros and Variables

CC      = sc
ASM     = asm
SLINK   = oml

# List of C object files
OBJS =  _exit.o _main.o abort.o access.o alloca.o amigados.o amigatime.o bcmp.o \
        bcopy.o bzero.o chmod.o chown.o close.o creat.o ctime.o devices.o dir.o \
        dir_data.o error.o error_msg.o exec.o fchmod.o fcntl.o fibstat.o \
        fifofd.o files.o fstat.o ftruncate.o getenv.o gethostname.o getpid.o \
        getwd.o gid.o grp.o index.o ioctl.o isatty.o kill.o link.o lseek.o \
        message.o mkdir.o mkfifo.o mktemp.o open.o perror.o pipe.o processes.o \
        protection.o pseudo_c.o pwd.o read.o rename.o rindex.o rmdir.o select.o \
        setjmp.o siglist.o signal.o signals.o sigpause.o sigsetmask.o sleep.o \
        stat.o strftime.o time.o timeconvert.o timers.o truncate.o uid.o \
        umask.o unlink.o utime.o wait4.o write.o

# List of Assembly object files
ASMOBJS = child.o sprintf.o _setjmp.o

# All object files combined
ALLOBJS = $(OBJS) $(ASMOBJS)

# Compiler and Assembler flags
# Using GST (Global Symbol Table) for faster compilation
INCS     = INCDIR=include/internal/ INCDIR=include/ INCDIR=include:
OPTIMIZE = OPTIMIZE       # General optimization: Global, Temps in regs, Data in regs
GSTFILE  = amiga.gst
GSTFLAGS = GST=$(GSTFILE)

CFLAGS   = $(INCS) $(OPTIMIZE) $(GSTFLAGS) NOICONS
ASMFLAGS = 

## Main Targets

all: unix.lib

unix.lib: $(ALLOBJS)
    -delete >NIL: $@
    oml $@ a $(ALLOBJS)

clean:
    delete quiet $(ALLOBJS) unix.lib $(GSTFILE) am.c

## Global Symbol Table (GST) Rule

# Rule to create the GST file. This mirrors the original lmkfile's logic
# by creating a temporary C file that just includes the master header.
$(GSTFILE): amiga.h
    copy amiga.h am.c
    $(CC) am.c MGST $(GSTFILE) $(INCS)
    delete quiet am.c

# Ensure the GST file is created before compiling any C source file
$(OBJS): $(GSTFILE)


## Implicit Suffix Rules

# smake has a built-in rule for .c.o:
# $(CC) $(CFLAGS) -c $< -o $@

# Rule to assemble .asm files into .o object files
.asm.o:
    $(ASM) $< -o $@ $(ASMFLAGS)


## Explicit Dependencies

# Assembly files
child.o: child.asm
sprintf.o: sprintf.asm
_setjmp.o: _setjmp.asm

# C source files
_exit.o: _exit.c fifo_pragmas.h fifo.h fifofd.h signals.h amiga.h
_main.o: _main.c fifo_pragmas.h fifo.h amigados.h fifofd.h signals.h amiga.h
abort.o: abort.c amiga.h
access.o: access.c amiga.h
alloca.o: alloca.c
amigados.o: amigados.c signals.h amiga.h
amigatime.o: amigatime.c timeconvert.h amiga.h
bcmp.o: bcmp.c amiga.h
bcopy.o: bcopy.c amiga.h
bzero.o: bzero.c amiga.h
chmod.o: chmod.c amiga.h
chown.o: chown.c amiga.h
close.o: close.c amiga.h
creat.o: creat.c amiga.h
ctime.o: ctime.c
devices.o: devices.c amiga.h
dir.o: dir.c dir_data.h amiga.h
dir_data.o: dir_data.c dir_data.h amiga.h
error.o: error.c amiga.h
error_msg.o: error_msg.c amiga.h
exec.o: exec.c processes.h amiga.h
fchmod.o: fchmod.c amiga.h
fcntl.o: fcntl.c amiga.h
fibstat.o: fibstat.c timeconvert.h amiga.h
fifofd.o: fifofd.c fifo_pragmas.h fifo.h fifofd.h amiga.h
files.o: files.c amiga.h
fstat.o: fstat.c amiga.h
ftruncate.o: ftruncate.c amiga.h
getenv.o: getenv.c amiga.h
gethostname.o: gethostname.c amiga.h
getpid.o: getpid.c processes.h signals.h amiga.h
getwd.o: getwd.c amiga.h
gid.o: gid.c amiga.h
grp.o: grp.c amiga.h
index.o: index.c
ioctl.o: ioctl.c amiga.h
isatty.o: isatty.c amiga.h
kill.o: kill.c processes.h signals.h amiga.h
link.o: link.c amiga.h
lseek.o: lseek.c amiga.h
message.o: message.c amiga.h
mkdir.o: mkdir.c amiga.h
mkfifo.o: mkfifo.c amiga.h
mktemp.o: mktemp.c amiga.h
open.o: open.c amigados.h amiga.h
perror.o: perror.c amiga.h
pipe.o: pipe.c fifo_pragmas.h fifo.h fifofd.h signals.h amiga.h
processes.o: processes.c processes.h amiga.h
protection.o: protection.c amiga.h
pseudo_c.o: pseudo_c.c amiga.h
pwd.o: pwd.c amiga.h
read.o: read.c amiga.h
rename.o: rename.c amiga.h
rindex.o: rindex.c
rmdir.o: rmdir.c amiga.h
select.o: select.c signals.h amiga.h
setjmp.o: setjmp.c signals.h amiga.h
siglist.o: siglist.c
signal.o: signal.c signals.h amiga.h
signals.o: signals.c processes.h signals.h amiga.h
sigpause.o: sigpause.c signals.h amiga.h
sigsetmask.o: sigsetmask.c signals.h amiga.h
sleep.o: sleep.c signals.h amiga.h
stat.o: stat.c dir_data.h amiga.h
strftime.o: strftime.c
time.o: time.c timeconvert.h amiga.h
timeconvert.o: timeconvert.c timeconvert.h amiga.h
timers.o: timers.c amiga.h
truncate.o: truncate.c amigados.h amiga.h
uid.o: uid.c amiga.h
umask.o: umask.c amiga.h
unlink.o: unlink.c amiga.h
utime.o: utime.c timeconvert.h amiga.h
wait4.o: wait4.c processes.h signals.h amiga.h
write.o: write.c amiga.h